<!DOCTYPE html>
<html lang="zh-cn">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="我的乐与怒">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="//localhost:1313//img/tianfu_3_st.jpg">
    <meta property="twitter:image" content="//localhost:1313//img/tianfu_3_st.jpg" />
    

    
    <meta name="title" content="集群安装Hadoop系列组件" />
    <meta property="og:title" content="集群安装Hadoop系列组件" />
    <meta property="twitter:title" content="集群安装Hadoop系列组件" />
    

    
    <meta name="description" content="In code we trust">
    <meta property="og:description" content="In code we trust" />
    <meta property="twitter:description" content="In code we trust" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="我的乐与怒,vincent mi, miwenshu, 电商,  博客, 个人网站, 互联网, Web, 云原生, PaaS, Java, Kubernetes, 微服务, Microservice">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>集群安装Hadoop系列组件 | 我的乐与怒 | Vincent&#39;s Blog</title>

    <link rel="canonical" href="/post/2016-07-11-install-hadoop-hbase-kafka/">

    


    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link rel="stylesheet" href="/fontawesome-free-6.4.0-web/css/all.min.css" rel="stylesheet" type="text/css">
    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="/js/lazysizes.min.js"></script>

    
    

</head>




<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">我的乐与怒</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">首页</a>
                    </li>
                    
                        
                    
                    
		    
                        <li><a href="/about/">我</a></li>
                    
                        <li><a href="/archive/">归档</a></li>
                    
                        <li><a href="/search/">搜索</a></li>
                    
                        <li><a href="/codesketch/">CodeSketch</a></li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/post-bg-line.jpg')
    }
    
    .titleColor {
        text-align: center;font-size:80px;
        color: #FFFFFF;
    }
   
    
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE" title="大数据">
                            大数据
                        </a>
                        
                        <a class="tag" href="/tags/hadoop" title="Hadoop">
                            Hadoop
                        </a>
                        
                        <a class="tag" href="/tags/hbase" title="HBase">
                            HBase
                        </a>
                        
                        <a class="tag" href="/tags/kafka" title="Kafka">
                            Kafka
                        </a>
                        
                        <a class="tag" href="/tags/zookeeper" title="ZooKeeper">
                            ZooKeeper
                        </a>
                        
                    </div>
                    <h1 class="titleColor">集群安装Hadoop系列组件</h1>
                    <h2 class="subheading titleColor"></h2>
                    <span class="meta titleColor">
                        
                            Posted by 
                            
                                Vincent
                             
                            on 
                            Monday, July 11, 2016
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <blockquote>
<p>公司日志系统扩容,考虑到后续数据暴增,选用HBase来进行存储,在本地VM进行一下演练
记录下安装过程备查</p>
</blockquote>
<blockquote>
<p>配置之前请查阅兼容列表
目前安装的版本 HADOOP-2.5.2  HBASE-1.1.5</p>
</blockquote>
<h1 id="hadoop-安装">Hadoop 安装</h1>
<h3 id="1配置">1.配置</h3>
<p>选择4台虚拟机作整个集群,配置如下</p>
<pre tabindex="0"><code>hdp1 10.0.0.30 #master
hdp2 10.0.0.31 #datanode
hdp3 10.0.0.32 #datanode
hdp4 10.0.0.33 #datanode
</code></pre><h3 id="2工具">2.工具</h3>
<p>远程执行命令</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#099">#!/bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#099"></span><span style="color:#09f;font-style:italic">#/opt/hdp/hdp_ssh</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">for</span> i in <span style="color:#f60">31</span> <span style="color:#f60">32</span> <span style="color:#f60">33</span> <span style="color:#f60">41</span> <span style="color:#f60">42</span> 43; <span style="color:#069;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span> <span style="color:#366">echo</span> -e <span style="color:#c30">&#34;\033[33m - 10.0.0.</span><span style="color:#a00">${</span><span style="color:#033">i</span><span style="color:#a00">}</span><span style="color:#c30"> -  \033[0m&#34;</span>
</span></span><span style="display:flex;"><span> ssh root@10.0.0.<span style="color:#033">$i</span> <span style="color:#033">$*</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">done</span> ;
</span></span></code></pre></div><p>远程执行命令,无额外输出</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#099">#!/bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#099"></span><span style="color:#09f;font-style:italic">#/opt/hdp/hdp_cmd</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">for</span> i in <span style="color:#f60">31</span> <span style="color:#f60">32</span> <span style="color:#f60">33</span> <span style="color:#f60">41</span> <span style="color:#f60">42</span> 43; <span style="color:#069;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span> <span style="color:#09f;font-style:italic">#echo -e &#34;\033[33m - 10.0.0.${i} -  \033[0m&#34;</span>
</span></span><span style="display:flex;"><span> ssh root@10.0.0.<span style="color:#033">$i</span> <span style="color:#033">$*</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">done</span> ;
</span></span></code></pre></div><p>加了2个alias</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#~/.bash_profile</span>
</span></span><span style="display:flex;"><span><span style="color:#366">alias</span> <span style="color:#033">r</span><span style="color:#555">=</span>/opt/hdp_ssh
</span></span><span style="display:flex;"><span><span style="color:#366">alias</span> <span style="color:#033">rcp</span><span style="color:#555">=</span>/opt/hdp_scp
</span></span><span style="display:flex;"><span><span style="color:#366">alias</span> <span style="color:#033">vi</span><span style="color:#555">=</span>vim
</span></span><span style="display:flex;"><span><span style="color:#366">export</span> <span style="color:#033">HDP</span><span style="color:#555">=</span>/opt/hdp/hadoop-2.5.2
</span></span></code></pre></div><p>上传文件到主机</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#099">#!/bin/sh
</span></span></span><span style="display:flex;"><span><span style="color:#099"></span><span style="color:#09f;font-style:italic">#/opt/hdp/hdp_scp</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">for</span> i in <span style="color:#f60">31</span> <span style="color:#f60">32</span> <span style="color:#f60">33</span> <span style="color:#f60">41</span> <span style="color:#f60">42</span> 43; <span style="color:#069;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#366">echo</span> -e <span style="color:#c30">&#34;\033[33m - 10.0.0.</span><span style="color:#a00">${</span><span style="color:#033">i</span><span style="color:#a00">}</span><span style="color:#c30"> -  \033[0m&#34;</span>
</span></span><span style="display:flex;"><span>  scp -r <span style="color:#033">$1</span> root@10.0.0.<span style="color:#033">$i</span>:<span style="color:#033">$2</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">done</span> ;
</span></span></code></pre></div><h3 id="3基础准备">3.基础准备</h3>
<h5 id="31-安装java">3.1 安装JAVA</h5>
<p>hadoop推荐使用官方的JDK,所以先删除旧的jdk .
因为我是新装没有这一步.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ rpm -qa|grep openjdk -i <span style="color:#09f;font-style:italic">#查找已经安装的OpenJDK，-i表示忽略“openjdk”的大小写</span>
</span></span><span style="display:flex;"><span>$ sudo yum remove java-1.6.0-openjdk-devel-1.6.0.0-6.1.13.4.el7_0.x86_64 <span style="color:#c30;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#c30;font-weight:bold"></span>java-1.7.0-openjdk-devel-1.7.0.65-2.5.1.2.el7_0.x86_64 <span style="color:#c30;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#c30;font-weight:bold"></span>java-1.7.0-openjdk-headless-1.7.0.65-2.5.1.2.el7_0.x86_64 <span style="color:#c30;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#c30;font-weight:bold"></span>java-1.7.0-openjdk-1.7.0.65-2.5.1.2.el7_0.x86_64 <span style="color:#c30;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#c30;font-weight:bold"></span>java-1.6.0-openjdk-1.6.0.0-6.1.13.4.el7_0.x86_64
</span></span></code></pre></div><p>下载官方JDK,解压拷贝到 <code>/usr/lib/jdk</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#033">$tar</span> -zxf jdk-8u60-linux-x64.tar.gz -C /usr/lib/jdk 
</span></span></code></pre></div><p>检查下确保 <code>/usr/lib/jdk/bin/java -version</code>可以显示内容类似即可.</p>
<pre tabindex="0"><code>[root@hdp1 opt]# /usr/lib/jdk/bin/java -version
java version &#34;1.8.0_91&#34;
Java(TM) SE Runtime Environment (build 1.8.0_91-b14)
Java HotSpot(TM) 64-Bit Server VM (build 25.91-b14, mixed mode)
</code></pre><p>环境变量,附加到 <code>/etc/profile</code> 的最后</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#09f;font-style:italic">## JAVA Environment</span>
</span></span><span style="display:flex;"><span><span style="color:#366">export</span> <span style="color:#033">JAVA_HOME</span><span style="color:#555">=</span>/usr/lib/jdk
</span></span><span style="display:flex;"><span><span style="color:#366">export</span> <span style="color:#033">JRE_HOME</span><span style="color:#555">=</span>/usr/lib/jdk
</span></span><span style="display:flex;"><span><span style="color:#366">export</span> <span style="color:#033">PATH</span><span style="color:#555">=</span><span style="color:#033">$JAVA_HOME</span>/bin:<span style="color:#033">$JRE_HOME</span>/bin:<span style="color:#033">$PATH</span>
</span></span><span style="display:flex;"><span><span style="color:#366">export</span> <span style="color:#033">CLASSPATH</span><span style="color:#555">=</span><span style="color:#033">$CLASSPATH</span>:.:<span style="color:#033">$JAVA_HOME</span>/lib:<span style="color:#033">$JRE_HOME</span>/lib
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">## JAVA Environment END</span>
</span></span></code></pre></div><h5 id="32-ssh配置">3.2 SSH配置</h5>
<p>SSH需要配置允许hadoop机器之间可以免密码访问.使用ssh key来实现.</p>
<p>打开ssh 的key登录</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#/etc/ssh/sshd_config 去掉以下三行的注释</span>
</span></span><span style="display:flex;"><span>RSAAuthentication yes
</span></span><span style="display:flex;"><span>PubkeyAuthentication yes
</span></span><span style="display:flex;"><span>AuthorizedKeysFile      .ssh/authorized_keys
</span></span></code></pre></div><p>生成每台机器的ssh-key</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ssh-keygen 
</span></span></code></pre></div><p>更新每台机器的host-key,CentOS只需要删除原来的Key重启即可.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>rm -f /etc/ssh/ssh_host_*
</span></span><span style="display:flex;"><span>service sshd restart
</span></span></code></pre></div><p>将Key文件收集起来.在hdp1机器上执行</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 将hdp1的key加入文件</span>
</span></span><span style="display:flex;"><span>cat ~/.ssh/id_rsa.pub &gt; ~/.ssh/authorized_keys
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 将其他机器的key附加到authorized_keys</span>
</span></span><span style="display:flex;"><span>/opt/hdp/hdp_cmd cat /root/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 修改权限</span>
</span></span><span style="display:flex;"><span>chmod <span style="color:#f60">600</span> ~/.ssh/authorized_keys
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 拷贝到其他机器</span>
</span></span><span style="display:flex;"><span>/opt/hdp/hdp_scp /root/.ssh/authorized_keys /root/.ssh/authorized_keys
</span></span></code></pre></div><p>收集服务器Key,这样就不用再ssh登录时还要打个Y</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 将hdp1的key加入文件</span>
</span></span><span style="display:flex;"><span>cat /etc/ssh/ssh_host_rsa_key.pub &gt; ~/.ssh/known_hosts
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 将其他机器的key附加到known_hosts</span>
</span></span><span style="display:flex;"><span>/opt/hdp/hdp_cmd cat /etc/ssh/ssh_host_rsa_key.pub &gt;&gt; ~/.ssh/known_hosts
</span></span></code></pre></div><p>完成后需要进行一下,在key前面加上IP地址和主机名</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>hdp4 ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAv3OFg8gwErGimjmtXAZ5wJBC/yA3WUcDKIGnpX8p/V5/yAoX11ZSgzw6wUSHh7qb5nU4yz/OafvLC48LEtT1NywZ7vfKANJ2hB/JxMxiInRAHDEVinujE7oZkSHSBBvCRcPqYx3uA6fAgxukAZmNEM7IdxUtIkBqIntNBq/OESQrZzqnB8sedSJP4hOFYN6UOWQED/V50ZK6iKZMUcFCQBzYulY3WiDMe4rKMDbyfaz9QzCvkHo82CvbjWg2i9DVyq4fPbXqd6E8cMznmV8PYPZTQhuIiJSkxboD4ui6s4/HdD3IShuxlXOaZR9WVq87WqU6UdxaFo9IiPFL8dtazw<span style="color:#555">==</span>
</span></span><span style="display:flex;"><span>10.0.0.33 ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAv3OFg8gwErGimjmtXAZ5wJBC/yA3WUcDKIGnpX8p/V5/yAoX11ZSgzw6wUSHh7qb5nU4yz/OafvLC48LEtT1NywZ7vfKANJ2hB/JxMxiInRAHDEVinujE7oZkSHSBBvCRcPqYx3uA6fAgxukAZmNEM7IdxUtIkBqIntNBq/OESQrZzqnB8sedSJP4hOFYN6UOWQED/V50ZK6iKZMUcFCQBzYulY3WiDMe4rKMDbyfaz9QzCvkHo82CvbjWg2i9DVyq4fPbXqd6E8cMznmV8PYPZTQhuIiJSkxboD4ui6s4/HdD3IShuxlXOaZR9WVq87WqU6UdxaFo9IiPFL8dtazw<span style="color:#555">==</span>
</span></span></code></pre></div><p>然后拷贝到其他机器</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>/opt/hdp/hdp_scp /root/.ssh/known_hosts /root/.ssh/known_hosts
</span></span></code></pre></div><p>编辑Host文件</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>hdp1 10.0.0.30 <span style="color:#09f;font-style:italic">#master</span>
</span></span><span style="display:flex;"><span>hdp2 10.0.0.31 <span style="color:#09f;font-style:italic">#datanode</span>
</span></span><span style="display:flex;"><span>hdp3 10.0.0.32 <span style="color:#09f;font-style:italic">#datanode</span>
</span></span><span style="display:flex;"><span>hdp4 10.0.0.33 <span style="color:#09f;font-style:italic">#datanode</span>
</span></span></code></pre></div><p>拷贝到其他机器</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>/opt/hdp/hdp_scp /etc/hosts /etc
</span></span></code></pre></div><p>在每台机器重启sshd  <code>service sshd restart</code>即可.
可以在任意一台机器使用 <code>ssh hdp1</code> 进行登录,没有任何提示即可</p>
<h3 id="4hadoop-配置">4.HADOOP 配置</h3>
<p>文件目录如下</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#555">[</span>root@hdp1 hdp<span style="color:#555">]</span><span style="color:#09f;font-style:italic"># pwd</span>
</span></span><span style="display:flex;"><span>/opt/hdp
</span></span><span style="display:flex;"><span><span style="color:#555">[</span>root@hdp1 hdp<span style="color:#555">]</span><span style="color:#09f;font-style:italic"># ls</span>
</span></span><span style="display:flex;"><span>hadoop-2.5.2  hbase-1.1.5  <span style="color:#366">test</span>  zookeeper-3.4.8
</span></span></code></pre></div><h5 id="41-需要配置如下文件">4.1 需要配置如下文件</h5>
<pre tabindex="0"><code>/opt/hdp/hadoop-2.5.2/etc/hadoop/hadoop-env.sh
/opt/hdp/hadoop-2.5.2/etc/hadoop/yarn-env.sh
/opt/hdp/hadoop-2.5.2/etc/hadoop/slaves
/opt/hdp/hadoop-2.5.2/etc/hadoop/core-site.xml
/opt/hdp/hadoop-2.5.2/etc/hadoop/hdfs-site.xml
/opt/hdp/hadoop-2.5.2/etc/hadoop/mapred-site.xml
/opt/hdp/hadoop-2.5.2/etc/hadoop/yarn-site.xml
</code></pre><p>修改hadoop-env.sh 和yarn-env.sh 的 JAVA_HOME .</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># The java implementation to use.</span>
</span></span><span style="display:flex;"><span><span style="color:#366">export</span> <span style="color:#033">JAVA_HOME</span><span style="color:#555">=</span>/usr/lib/jdk
</span></span></code></pre></div><p>修改slave文件</p>
<pre tabindex="0"><code>hdp2
hdp3
hdp4
</code></pre><p>core-site.xml 文件设置端口信息</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;name&gt;</span>fs.defaultFS<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;value&gt;</span>hdfs://hdp1:9000<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;name&gt;</span>io.file.buffer.size<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;value&gt;</span>131072<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;name&gt;</span>hadoop.tmp.dir<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;value&gt;</span>file:/hdp/tmp<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;description&gt;</span>Abasefor other temporary directories.<span style="color:#309;font-weight:bold">&lt;/description&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;name&gt;</span>hadoop.proxyuser.spark.hosts<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;value&gt;</span>*<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;name&gt;</span>hadoop.proxyuser.spark.groups<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;value&gt;</span>*<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>hdfs-site.xml 设置DFS的路径</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#309;font-weight:bold">&lt;name&gt;</span>dfs.namenode.secondary.http-address<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#309;font-weight:bold">&lt;value&gt;</span>master:9001<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;name&gt;</span>dfs.namenode.name.dir<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;value&gt;</span>file:/hdp/dfs/name<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;name&gt;</span>dfs.datanode.data.dir<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;value&gt;</span>file:/hdp/dfs/data<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;name&gt;</span>dfs.replication<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;value&gt;</span>3<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;name&gt;</span>dfs.webhdfs.enabled<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;value&gt;</span>true<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>mapred-site.xml</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;name&gt;</span>mapreduce.framework.name<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;value&gt;</span>yarn<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;name&gt;</span>mapreduce.jobhistory.address<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;value&gt;</span>hdp1:10020<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;name&gt;</span>mapreduce.jobhistory.webapp.address<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;value&gt;</span>hdp1:19888<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>yarn-site.xml</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;name&gt;</span>yarn.nodemanager.aux-services<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;value&gt;</span>mapreduce_shuffle<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;name&gt;</span>yarn.nodemanager.aux-services.mapreduce.shuffle.class<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;value&gt;</span>org.apache.hadoop.mapred.ShuffleHandler<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;name&gt;</span>yarn.resourcemanager.address<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;value&gt;</span>hdp1:8032<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;name&gt;</span>yarn.resourcemanager.scheduler.address<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;value&gt;</span>hdp1:8030<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;name&gt;</span>yarn.resourcemanager.resource-tracker.address<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;value&gt;</span>hdp1:8035<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;name&gt;</span>yarn.resourcemanager.admin.address<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;value&gt;</span>hdp1:8033<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;name&gt;</span>yarn.resourcemanager.webapp.address<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#309;font-weight:bold">&lt;value&gt;</span>hdp1:8088<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/configuration&gt;</span>
</span></span></code></pre></div><p><strong>ulimit配置</strong>
HBase运行时会打卡很多句柄,因此需要修改可打开的最大句柄数量和最大进程数量,修改文件<code>/etc/security/limits.conf </code> ,原始内容如下</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#&lt;domain&gt;      &lt;type&gt;  &lt;item&gt;         &lt;value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#*               soft    core            0</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#*               hard    rss             10000</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#@student        hard    nproc           20</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#@faculty        soft    nproc           20</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#@faculty        hard    nproc           50</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#ftp             hard    nproc           0</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">#@student        -       maxlogins       4</span>
</span></span></code></pre></div><p>修改对Hadoop的限制</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 以下内容添加到 /etc/security/limits.conf  文件后面</span>
</span></span><span style="display:flex;"><span>* hard nofile <span style="color:#f60">10000</span>
</span></span><span style="display:flex;"><span>* soft nofile <span style="color:#f60">10000</span> 
</span></span><span style="display:flex;"><span>* hard nproc <span style="color:#f60">10000</span>
</span></span><span style="display:flex;"><span>* soft nproc <span style="color:#f60">10000</span>
</span></span></code></pre></div><p>然后重启所有机器 让配置生效,<code>*</code> 可以换成你运行Hadoop的用户名.</p>
<p>将配置好的文件拷贝到所有机器</p>
<h5 id="42-格式化">4.2 格式化</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 格式化文件系统</span>
</span></span><span style="display:flex;"><span>/opt/hdp/hadoop-2.5.2/bin/hdfs namenode -format
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 启动dfs</span>
</span></span><span style="display:flex;"><span>/opt/hdp/hadoop-2.5.2/sbin/sbin/start-dfs.sh 
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 启动yarn</span>
</span></span><span style="display:flex;"><span>/opt/hdp/hadoop-2.5.2/sbin/sbin/start-yarn.sh 
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># HDFS报告</span>
</span></span><span style="display:flex;"><span>/opt/hdp/hadoop-2.5.2/bin/hdfs dfsadmin -report
</span></span></code></pre></div><p>查看集群状态</p>
<p><a href="HDFS">http://hadoop1:50070/</a></p>
<p><a href="RM">http://hadoop1:8088/</a></p>
<h4 id="tips">TIPS</h4>
<ul>
<li>执行控制台时可能会出现这个错误</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>WARN util.NativeCodeLoader: Unable to load native-hadoop library <span style="color:#069;font-weight:bold">for</span> your platform... using builtin-java classes where applicable
</span></span></code></pre></div><p>原因是因为Hadoop编译好的Native库有一个依赖库版本和操作系统的不一致.解决方法是自己重新编译. 可以使用``ldd```命令查看依赖库的情况.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#555">[</span>root@hdp1 hadoop-2.5.2<span style="color:#555">]</span><span style="color:#09f;font-style:italic"># ldd lib/native/libhadoop.so.1.0.0</span>
</span></span><span style="display:flex;"><span>lib/native/libhadoop.so.1.0.0: /lib64/libc.so.6: version <span style="color:#c30">`</span>GLIBC_2.14<span style="color:#a00;background-color:#faa">&#39;</span> not found <span style="color:#555">(</span>required by lib/native/libhadoop.so.1.0.0<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>	linux-vdso.so.1 <span style="color:#555">=</span>&gt;  <span style="color:#555">(</span>0x00007fffdcb29000<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>	libdl.so.2 <span style="color:#555">=</span>&gt; /lib64/libdl.so.2 <span style="color:#555">(</span>0x00007f07ef2b5000<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>	libc.so.6 <span style="color:#555">=</span>&gt; /lib64/libc.so.6 <span style="color:#555">(</span>0x00007f07eef20000<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>	/lib64/ld-linux-x86-64.so.2 <span style="color:#555">(</span>0x00007f07ef6db000<span style="color:#555">)</span>
</span></span></code></pre></div><p>修改 <code>/opt/hdp/hadoop-2.5.2/etc/hadoop/log4j.properties</code>增加下面一行可以屏蔽掉这个错误.</p>
<pre tabindex="0"><code>log4j.logger.org.apache.hadoop.util.NativeCodeLoader=DEBUG
</code></pre><h3 id="5hbase-配置">5.HBase 配置</h3>
<h5 id="51--服务器">5.1  服务器</h5>
<pre tabindex="0"><code>## HBASE HOSTS
10.0.0.41 p1  # HMaser zkMaster
10.0.0.42 p2  # HMaster backup zk 
10.0.0.43 p3
10.0.0.44 p4
</code></pre><p>和Hadoop类似,拷贝各个的key到authorized_keys已经known_hosts使主机之间可以无密码登录.</p>
<p>hbase-env.sh</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#366">export</span> <span style="color:#033">JAVA_HOME</span><span style="color:#555">=</span>/usr/lib/jdk
</span></span></code></pre></div><p>配置<code>hbase-site.xml</code> , 配置Hbase的数据存放到hdfs的/hbase目录下 . 设置zk的数据路径</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#309;font-weight:bold">&lt;name&gt;</span>hbase.rootdir<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#309;font-weight:bold">&lt;value&gt;</span>hdfs://hdp1:9000/hbase<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#309;font-weight:bold">&lt;name&gt;</span>hbase.cluster.distributed<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#309;font-weight:bold">&lt;value&gt;</span>true<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#309;font-weight:bold">&lt;name&gt;</span>hbase.zookeeper.quorum<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#309;font-weight:bold">&lt;value&gt;</span>p1,p2,p3<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#309;font-weight:bold">&lt;name&gt;</span>hbase.zookeeper.property.dataDir<span style="color:#309;font-weight:bold">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#309;font-weight:bold">&lt;value&gt;</span>/opt/zk<span style="color:#309;font-weight:bold">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#309;font-weight:bold">&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>启动HBase</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>/opt/hdp/hbase-1.1.5/bin/start-hbase.sh
</span></span></code></pre></div><p>用JPS检查整个集群的进程</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#555">[</span>root@hdp1 hbase-1.1.5<span style="color:#555">]</span><span style="color:#09f;font-style:italic"># r /usr/lib/jdk/bin/jps</span>
</span></span><span style="display:flex;"><span> - 10.0.0.31 -
</span></span><span style="display:flex;"><span><span style="color:#f60">2289</span> NodeManager
</span></span><span style="display:flex;"><span><span style="color:#f60">2613</span> Jps
</span></span><span style="display:flex;"><span><span style="color:#f60">2200</span> DataNode
</span></span><span style="display:flex;"><span> - 10.0.0.32 -
</span></span><span style="display:flex;"><span><span style="color:#f60">2179</span> DataNode
</span></span><span style="display:flex;"><span><span style="color:#f60">2587</span> Jps
</span></span><span style="display:flex;"><span><span style="color:#f60">2268</span> NodeManager
</span></span><span style="display:flex;"><span> - 10.0.0.33 -
</span></span><span style="display:flex;"><span><span style="color:#f60">2517</span> Jps
</span></span><span style="display:flex;"><span><span style="color:#f60">2198</span> NodeManager
</span></span><span style="display:flex;"><span><span style="color:#f60">2109</span> DataNode
</span></span><span style="display:flex;"><span> - 10.0.0.41 -
</span></span><span style="display:flex;"><span><span style="color:#f60">2167</span> HMaster
</span></span><span style="display:flex;"><span><span style="color:#f60">1803</span> HQuorumPeer
</span></span><span style="display:flex;"><span><span style="color:#f60">2700</span> Jps
</span></span><span style="display:flex;"><span> - 10.0.0.42 -
</span></span><span style="display:flex;"><span><span style="color:#f60">2274</span> HMaster
</span></span><span style="display:flex;"><span><span style="color:#f60">1781</span> HQuorumPeer
</span></span><span style="display:flex;"><span><span style="color:#f60">2697</span> Jps
</span></span><span style="display:flex;"><span><span style="color:#f60">2203</span> HRegionServer
</span></span><span style="display:flex;"><span> - 10.0.0.43 -
</span></span><span style="display:flex;"><span><span style="color:#f60">2340</span> Jps
</span></span><span style="display:flex;"><span><span style="color:#f60">1672</span> HQuorumPeer
</span></span><span style="display:flex;"><span><span style="color:#f60">2012</span> HRegionServer
</span></span></code></pre></div><p>访问 <a href="http://p1:16010/">http://p1:16010/</a>查看HBase运行情况</p>
<p>也可以启动REST API 玩玩.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>/opt/hdp/hbase-1.1.5/bin/hbase rest start -p <span style="color:#f60">8888</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic"># 可以通过 http://p1:8888/test/schema访问 test表的schema</span>
</span></span></code></pre></div><h5 id="52-错误问题">5.2 错误问题</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>java.net.NoRouteToHostException: 没有到主机的路由
</span></span><span style="display:flex;"><span>	at sun.nio.ch.SocketChannelImpl.checkConnect<span style="color:#555">(</span>Native Method<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>	at sun.nio.ch.SocketChannelImpl.finishConnect<span style="color:#555">(</span>SocketChannelImpl.java:717<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>	at org.apache.zookeeper.ClientCnxnSocketNIO.doTransport<span style="color:#555">(</span>ClientCnxnSocketNIO.java:361<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>	at org.apache.zookeeper.ClientCnxn<span style="color:#033">$SendThread</span>.run<span style="color:#555">(</span>ClientCnxn.java:1081<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>2016-07-12 14:32:26,877 INFO  <span style="color:#555">[</span>main-SendThread<span style="color:#555">(</span>hdp1:2181<span style="color:#555">)]</span> zookeeper.ClientCnxn: Opening socket connection to server hdp1/10.0.0.30:2181. Will not attempt to authenticate using SASL <span style="color:#555">(</span>unknown error<span style="color:#555">)</span>
</span></span><span style="display:flex;"><span>2016-07-12 14:32:26,878 INFO  <span style="color:#555">[</span>main-SendThread<span style="color:#555">(</span>hdp1:2181<span style="color:#555">)]</span> zookeeper.ClientCnxn: Socket connection established to hdp1/10.0.0.30:2181, initiating session
</span></span><span style="display:flex;"><span>2016-07-12 14:32:26,879 INFO  <span style="color:#555">[</span>main-SendThread<span style="color:#555">(</span>hdp1:2181<span style="color:#555">)]</span> zookeeper.ClientCnxn: Unable to <span style="color:#366">read</span> additional data from server sessionid 0x0, likely server has closed socket, closing socket connection and attempting reconnect
</span></span><span style="display:flex;"><span>2016-07-12 14:32:27,325 INFO  <span style="color:#555">[</span>main-SendThread<span style="color:#555">(</span>hdp3:2181<span style="color:#555">)]</span> zookeeper.ClientCnxn: Opening socket connection to server hdp3/10.0.0.32:2181. Will not attempt to authenticate using SASL <span style="color:#555">(</span>unknown error<span style="color:#555">)</span>
</span></span></code></pre></div><p>出现该错误是因为端口没打开,关闭<code>service iptables stop</code> 防火墙即可.</p>
<h1 id="6-安装kafka">6 安装Kafka</h1>
<p>Kafka的安装非常简单,解压后修改配置文件</p>


                
                
<div class="entry-shang text-center">
    
	    <p>「真诚赞赏，手留余香」</p>
	
	<button class="zs show-zs btn btn-bred">赞赏支持</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">×</button>
		<span class="author"><a href="//localhost:1313/"><img src="/img/favicon.png" />我的乐与怒</a></span>
        
	        <p class="tip"><i></i><span>真诚赞赏，手留余香</span></p>
		
 
	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2元</button>
			<button class="btn btn-blink" data-num="5">5元</button>
			<button class="btn btn-blink" data-num="10">10元</button>
			<button class="btn btn-blink" data-num="50">50元</button>
			<button class="btn btn-blink" data-num="100">100元</button>
			<button class="btn btn-blink" data-num="1">任意金额</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2元</button>
			<p>使用<span id="pay-type">微信</span>扫描二维码完成支付</p>
			<img src="/img/reward/wechat-2.png"  id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
		<label><input type="radio" name="zs-type" value="wechat" class="zs-type" checked="checked"><span ><span class="zs-wechat"><img src="/img/reward/wechat-btn.png"/></span></label>
		<label><input type="radio" name="zs-type" value="alipay" class="zs-type" class="zs-alipay"><img src="/img/reward/alipay-btn.png"/></span></label>
	</div>
</div>
<script type="text/javascript" src="/js/reward.js"></script>

                

                
                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/2016-06-22-golang-errors-are-values/" data-toggle="tooltip" data-placement="top" title="Golang:错误即值 Errors are values"><i class="fa fa-angle-left fa-lg"></i>
                            Previous</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/2016-07-21-jenkins-jekyll-integration/" data-toggle="tooltip" data-placement="top" title="Jenkins集成jekyll">Next
                        <i class="fa fa-angle-right fa-lg"></i></a>
                    </li>
                    
                </ul>
                

                



            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">目录</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">标签</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        <a href="/tags/aframe" title="aframe">
                            aframe
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/andrew-ng" title="andrew-ng">
                            andrew-ng
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/arduino" title="arduino">
                            arduino
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/blockchain" title="blockchain">
                            blockchain
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/cgi" title="cgi">
                            cgi
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/consul" title="consul">
                            consul
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/docker" title="docker">
                            docker
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/eth" title="eth">
                            eth
                        </a>
                        
                        
                        
                        <a href="/tags/ethereum" title="ethereum">
                            ethereum
                        </a>
                        
                        
                        
                        <a href="/tags/evm" title="evm">
                            evm
                        </a>
                        
                        
                        
                        <a href="/tags/feign" title="feign">
                            feign
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/golang" title="golang">
                            golang
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/hw" title="hw">
                            hw
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/java" title="java">
                            java
                        </a>
                        
                        
                        
                        <a href="/tags/javascript" title="javascript">
                            javascript
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/jpa" title="jpa">
                            jpa
                        </a>
                        
                        
                        
                        <a href="/tags/js" title="js">
                            js
                        </a>
                        
                        
                        
                        <a href="/tags/k8s" title="k8s">
                            k8s
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kubernetes" title="kubernetes">
                            kubernetes
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/linux" title="linux">
                            linux
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/mac" title="mac">
                            mac
                        </a>
                        
                        
                        
                        <a href="/tags/machine-learning" title="machine-learning">
                            machine-learning
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/math" title="math">
                            math
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/mysql" title="mysql">
                            mysql
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/nginx" title="nginx">
                            nginx
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/op" title="op">
                            op
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/ops" title="ops">
                            ops
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/poco" title="poco">
                            poco
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/pptp" title="pptp">
                            pptp
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/rd" title="rd">
                            rd
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/spring" title="spring">
                            spring
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/springboot" title="springboot">
                            springboot
                        </a>
                        
                        
                        
                        <a href="/tags/ssl" title="ssl">
                            ssl
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/thymeleaf" title="thymeleaf">
                            thymeleaf
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/type" title="type">
                            type
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/vagrant" title="vagrant">
                            vagrant
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/vpn" title="vpn">
                            vpn
                        </a>
                        
                        
                        
                        <a href="/tags/vue" title="vue">
                            vue
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/webrtc" title="webrtc">
                            webrtc
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0" title="技术文章">
                            技术文章
                        </a>
                        
                        
                        
                        <a href="/tags/%E6%96%B0%E6%B5%AA%E5%8D%9A%E5%AE%A2" title="新浪博客">
                            新浪博客
                        </a>
                        
                        
                        
                        <a href="/tags/%E6%97%A0%E8%81%8A" title="无聊">
                            无聊
                        </a>
                        
                        
                        
                        <a href="/tags/%E7%94%9F%E6%B4%BB" title="生活">
                            生活
                        </a>
                        
                        
                        
                        <a href="/tags/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95" title="生活记录">
                            生活记录
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E8%82%A1%E7%A5%A8" title="股票">
                            股票
                        </a>
                        
                        
                        
                        <a href="/tags/%E8%BF%90%E7%BB%B4" title="运维">
                            运维
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>链接</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href="http://blog.sina.com.cn/vegas">青鸟的翅膀</a></li>
                        
                        <li><a target="_blank" href="http://blog.sina.com.cn/yoshikilau">Caffeine Park</a></li>
                        
                        <li><a target="_blank" href="http://huxpro.github.io">Theme From Hux</a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    
                    <li>
                        <a href="https://twitter.com/miwenshu">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/vincentz">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
		            
                    
                    

		            
                    
                    <li>
                        <a target="_blank" href="/img/icwt.jpg">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    <li>
                        <a target="_blank" href="https://github.com/vincentmi">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/miwenshu">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    <li>
                        <a target="_blank" href="https://stackoverflow.com/users/5311815/vincent-mi">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
            
            
            
           
                   <li>
                       <a href='' rel="alternate" type="application/rss+xml" title="我的乐与怒" >
                           <span class="fa-stack fa-lg">
                               <i class="fas fa-circle fa-stack-2x"></i>
                               <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
            
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; 我的乐与怒 2023 | <a href="http://www.beian.miit.gov.cn" style="text-decoration: none;"> 蜀ICP备17040089号-2</a>
                    <br>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-78738242-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>






</body>
</html>
